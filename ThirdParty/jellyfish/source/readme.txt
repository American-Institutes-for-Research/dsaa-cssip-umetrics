This code borrowed from https://github.com/sunlightlabs/jellyfish/.  It had to be modified
to compile under MSVC.